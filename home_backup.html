<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>เธซเธเนเธฒเธซเธฅเธฑเธ - เธฃเธฐเธเธเธเธฐเนเธเธเธเธคเธ•เธดเธเธฃเธฃเธก</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    :root {
      --bg: #08090d;
      --surface: #12141c;
      --surface-2: #1a1d28;
      --surface-3: #242736;
      --border: #2a2d3a;
      --border-hover: #3d4156;

      --neon-blue: #00d4ff;
      --neon-purple: #a855f7;
      --neon-green: #22d3a7;
      --neon-red: #ff4d6a;
      --neon-amber: #ffb020;
      --neon-pink: #f472b6;

      --primary: #00d4ff;
      --secondary: #a855f7;
      --success: #22d3a7;
      --warning: #ffb020;
      --danger: #ff4d6a;

      --text: #e8eaf0;
      --text-2: #8b8fa7;
      --text-3: #555872;

      /* Legacy compat aliases */
      --accent-cyan: #00d4ff;
      --accent-violet: #a855f7;
      --accent-green: #22d3a7;
      --accent-red: #ff4d6a;
      --accent-amber: #ffb020;
      --text-main: #e8eaf0;
      --text-muted: #8b8fa7;
      --text-dim: #555872;
      --bg-card: #12141c;
      --border-color: #2a2d3a;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Prompt', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      -webkit-tap-highlight-color: transparent;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(16px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes wave {

      0%,
      60%,
      100% {
        transform: rotate(0);
      }

      10% {
        transform: rotate(14deg);
      }

      20% {
        transform: rotate(-8deg);
      }

      30% {
        transform: rotate(14deg);
      }

      40% {
        transform: rotate(-4deg);
      }

      50% {
        transform: rotate(10deg);
      }
    }

    @keyframes zoomIn {
      from {
        opacity: 0;
        transform: scale(.9);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px 16px 80px;
    }

    /* โ•โ•โ•โ•โ•โ• NAVBAR โ•โ•โ•โ•โ•โ• */
    .navbar {
      background: var(--bg);
      border-bottom: 1px solid var(--border);
      padding: 10px 0;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .navbar-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 900px;
      margin: 0 auto;
      padding: 0 16px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand img {
      height: 60px;
      width: auto;
      object-fit: contain;
    }

    .brand-tpac-logo {
      height: 90px !important;
      width: auto;
      margin-left: 6px;
      mix-blend-mode: screen;
      filter: contrast(1.1) brightness(1.1);
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-details {
      text-align: right;
      display: none;
    }

    @media(min-width:768px) {
      .user-details {
        display: block;
      }
    }

    .user-name {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text);
    }

    .user-id {
      font-size: 0.75rem;
      color: var(--text-3);
    }

    .btn-logout {
      width: 38px;
      height: 38px;
      background: transparent;
      color: var(--text-3);
      border: 1px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.95rem;
      transition: color 0.2s, border-color 0.2s;
    }

    .btn-logout:hover {
      color: var(--neon-red);
      border-color: var(--neon-red);
    }

    /* โ•โ•โ•โ•โ•โ• CARDS โ•โ•โ•โ•โ•โ• */
    .glass-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 24px;
      margin-bottom: 16px;
    }

    /* โ•โ•โ•โ•โ•โ• SCORE โ•โ•โ•โ•โ•โ• */
    .score-section {
      text-align: center;
      padding: 32px 24px;
      position: relative;
      animation: fadeIn 0.6s ease;
    }

    .score-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 24px;
      right: 24px;
      height: 2px;
      background: linear-gradient(90deg, var(--neon-blue), var(--neon-purple), var(--neon-pink));
      border-radius: 2px;
    }

    .score-title {
      font-size: 0.8rem;
      color: var(--text-3);
      text-transform: uppercase;
      letter-spacing: 2px;
      font-weight: 400;
      margin-bottom: 16px;
    }

    .score-value {
      font-size: 5rem;
      font-weight: 700;
      line-height: 1;
      background: linear-gradient(135deg, var(--neon-blue), var(--neon-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      letter-spacing: -2px;
    }

    .score-subtitle {
      font-size: 0.85rem;
      color: var(--text-2);
      margin-bottom: 20px;
      font-weight: 300;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 16px;
      border-radius: 20px;
      font-weight: 500;
      font-size: 0.82rem;
      background: var(--surface-2);
      border: 1px solid var(--border);
    }

    .status-normal {
      color: var(--neon-green);
      border-color: rgba(34, 211, 167, 0.25);
    }

    .status-risk {
      color: var(--neon-amber);
      border-color: rgba(255, 176, 32, 0.25);
    }

    .status-urgent {
      color: var(--neon-red);
      border-color: rgba(255, 77, 106, 0.3);
    }

    .status-excellent {
      color: var(--neon-amber);
      border-color: rgba(255, 176, 32, 0.3);
    }

    /* โ•โ•โ•โ•โ•โ• MENU GRID โ•โ•โ•โ•โ•โ• */
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }

    .menu-item {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px 12px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.15s ease, border-color 0.15s ease;
      animation: fadeIn 0.4s ease backwards;
      position: relative;
    }

    .menu-item:hover {
      transform: translateY(-3px);
      border-color: var(--border-hover);
    }

    .menu-item:active {
      transform: translateY(0);
    }

    .menu-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 10px;
      font-size: 1.25rem;
    }

    .menu-label {
      font-size: 0.88rem;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 2px;
    }

    .menu-desc {
      font-size: 0.7rem;
      color: var(--text-3);
      font-weight: 300;
    }

    .icon-history {
      background: rgba(0, 212, 255, 0.08);
      color: var(--neon-blue);
    }

    .icon-rules {
      background: rgba(168, 85, 247, 0.08);
      color: var(--neon-purple);
    }

    .icon-qr {
      background: rgba(255, 176, 32, 0.08);
      color: var(--neon-amber);
    }

    .icon-profile {
      background: rgba(34, 211, 167, 0.08);
      color: var(--neon-green);
    }

    .menu-item:hover .icon-history {
      background: rgba(0, 212, 255, 0.15);
    }

    .menu-item:hover .icon-rules {
      background: rgba(168, 85, 247, 0.15);
    }

    .menu-item:hover .icon-qr {
      background: rgba(255, 176, 32, 0.15);
    }

    .menu-item:hover .icon-profile {
      background: rgba(34, 211, 167, 0.15);
    }

    .delay-1 {
      animation-delay: 0s;
    }

    .delay-2 {
      animation-delay: 0.05s;
    }

    .delay-3 {
      animation-delay: 0.1s;
    }

    .delay-4 {
      animation-delay: 0.15s;
    }

    /* โ•โ•โ•โ•โ•โ• INFO โ•โ•โ•โ•โ•โ• */
    .info-list {
      list-style: none;
      padding: 0;
    }

    .info-item {
      display: flex;
      align-items: center;
      padding: 11px 0;
      border-bottom: 1px solid var(--border);
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: rgba(0, 212, 255, 0.06);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      color: var(--neon-blue);
      font-size: 0.85rem;
    }

    .info-content__label {
      font-size: 0.68rem;
      color: var(--text-3);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      font-weight: 400;
    }

    .info-content__value {
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--text);
    }

    /* โ•โ•โ•โ•โ•โ• MODALS โ•โ•โ•โ•โ•โ• */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(4, 5, 8, 0.85);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      width: 92%;
      max-width: 460px;
      max-height: 80vh;
      overflow-y: auto;
      transform: scale(0.96);
      transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .modal-overlay.active .modal {
      transform: scale(1);
    }

    .modal-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: var(--surface);
      z-index: 10;
    }

    .modal-title {
      font-size: 1.05rem;
      font-weight: 600;
      color: var(--text);
    }

    .btn-close {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-3);
      font-size: 1rem;
      cursor: pointer;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.15s, border-color 0.15s;
    }

    .btn-close:hover {
      color: var(--neon-red);
      border-color: var(--neon-red);
    }

    .modal-body {
      padding: 20px;
      color: var(--text-2);
      line-height: 1.7;
      font-weight: 300;
    }

    .modal-body h3 {
      color: var(--text);
      margin: 14px 0 8px;
      font-size: 1rem;
      font-weight: 500;
      padding-left: 12px;
      border-left: 2px solid var(--neon-blue);
    }

    .modal-body ul {
      padding-left: 18px;
    }

    .modal-body li {
      margin-bottom: 5px;
    }

    /* โ•โ•โ•โ•โ•โ• SCROLLBAR โ•โ•โ•โ•โ•โ• */
    ::-webkit-scrollbar {
      width: 4px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 2px;
    }

    /* โ•โ•โ•โ•โ•โ• PROFILE โ•โ•โ•โ•โ•โ• */
    .profile-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .profile-img-container {
      width: 100px;
      height: 100px;
      margin: 0 auto 10px;
      position: relative;
      cursor: pointer;
    }

    .profile-img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--neon-blue);
    }

    .profile-badge {
      position: absolute;
      bottom: 2px;
      right: 2px;
      background: var(--neon-blue);
      color: #08090d;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid var(--surface);
      font-size: 0.7rem;
      font-weight: 700;
    }

    /* โ•โ•โ•โ•โ•โ• TOAST โ•โ•โ•โ•โ•โ• */
    .toast-container {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 2000;
      display: flex;
      flex-direction: column;
      gap: 8px;
      pointer-events: none;
    }

    .toast {
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-left: 3px solid var(--neon-blue);
      padding: 12px 16px;
      border-radius: 10px;
      min-width: 260px;
      max-width: 360px;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      transform: translateX(110%);
      transition: transform 0.25s ease;
      pointer-events: auto;
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast-icon {
      font-size: 1rem;
      margin-top: 1px;
    }

    .toast-content {
      flex: 1;
    }

    .toast-title {
      font-weight: 500;
      font-size: 0.85rem;
      color: var(--text);
    }

    .toast-msg {
      font-size: 0.78rem;
      color: var(--text-2);
      line-height: 1.4;
      margin-top: 2px;
    }

    .toast-success {
      border-left-color: var(--neon-green);
    }

    .toast-success .toast-icon {
      color: var(--neon-green);
    }

    .toast-error {
      border-left-color: var(--neon-red);
    }

    .toast-error .toast-icon {
      color: var(--neon-red);
    }

    .toast-info {
      border-left-color: var(--neon-blue);
    }

    .toast-info .toast-icon {
      color: var(--neon-blue);
    }

    /* โ•โ•โ•โ•โ•โ• PROFILE VIEWER โ•โ•โ•โ•โ•โ• */
    .pv-overlay {
      position: fixed;
      inset: 0;
      background: rgba(4, 5, 8, 0.95);
      z-index: 3000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .pv-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .pv-img {
      max-width: 88%;
      max-height: 70vh;
      border-radius: 10px;
      border: 1px solid var(--border);
      transform: scale(0.94);
      transition: transform 0.2s ease;
    }

    .pv-overlay.active .pv-img {
      transform: scale(1);
    }

    .pv-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: var(--surface-2);
      border: 1px solid var(--border);
      color: var(--text-2);
      width: 38px;
      height: 38px;
      border-radius: 50%;
      font-size: 1rem;
      cursor: pointer;
      transition: color 0.15s;
    }

    .pv-close:hover {
      color: var(--neon-red);
    }

    /* โ•โ•โ•โ•โ•โ• RESPONSIVE โ•โ•โ•โ•โ•โ• */
    @media(max-width:640px) {
      .score-value {
        font-size: 3.5rem;
      }

      .score-section {
        padding: 24px 16px;
      }

      .score-section::before {
        left: 16px;
        right: 16px;
      }

      .menu-grid {
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }

      .menu-item {
        padding: 16px 10px;
      }

      .menu-icon {
        width: 40px;
        height: 40px;
        font-size: 1.1rem;
        margin-bottom: 8px;
      }

      .menu-label {
        font-size: 0.82rem;
      }

      .glass-card {
        padding: 16px;
        border-radius: 12px;
      }

      .container {
        padding: 12px 10px 70px;
      }

      .toast {
        min-width: unset;
        max-width: 88vw;
      }
    }

    @media(max-width:380px) {
      .score-value {
        font-size: 2.6rem;
        letter-spacing: -1px;
      }

      .brand img {
        height: 45px;
      }

      .brand-tpac-logo {
        height: 68px !important;
      }
    }
  </style>

</head>


<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-content">
      <div class="brand">
        <img src="logo.png" alt="Logo">
        <img src="LOGOprogram/logoV2.png" alt="TPAC System" class="brand-tpac-logo">
      </div>
      <div class="user-menu">
        <div class="user-details" style="text-align: right;">
          <div class="user-name" id="navUserName">...</div>
          <div class="user-id" id="navUserId">...</div>
        </div>
        <button class="btn-logout" onclick="logout()">
          <i class="fas fa-power-off"></i>
          <span style="display: none;">เธญเธญเธ</span>
        </button>
      </div>
    </div>
  </nav>

  <div class="container">
    <!-- Score Card -->
    <div class="glass-card score-section">
      <h2 class="score-title">เธเธฐเนเธเธเธเธคเธ•เธดเธเธฃเธฃเธกเธเธญเธเธเธธเธ“</h2>
      <div class="score-value" id="scoreValue">-</div>
      <p class="score-subtitle">เธเธฒเธเธเธฐเนเธเธเน€เธ•เนเธก 100 เธเธฐเนเธเธ</p>
      <div id="statusBadgeContainer">
        <span class="status-pill status-normal" id="statusBadge">
          <i class="fas fa-check-circle"></i> เธเธเธ•เธด
        </span>
      </div>
    </div>

    <!-- Menu Grid -->
    <div class="menu-grid">
      <div class="menu-item delay-1" onclick="openModal('history')">
        <div class="menu-icon icon-history"><i class="fas fa-history"></i></div>
        <div class="menu-label">เธเธฃเธฐเธงเธฑเธ•เธด</div>
        <div class="menu-desc">เธเธฒเธฃเน€เธเธฅเธทเนเธญเธเนเธซเธงเธเธฐเนเธเธ</div>
      </div>
      <div class="menu-item delay-2" onclick="openModal('rules')">
        <div class="menu-icon icon-rules"><i class="fas fa-book-open"></i></div>
        <div class="menu-label">เธเธเธฃเธฐเน€เธเธตเธขเธ</div>
        <div class="menu-desc">เน€เธเธ“เธ‘เนเธเธฒเธฃเธ•เธฑเธ”เธเธฐเนเธเธ</div>
      </div>
      <div class="menu-item delay-3" onclick="openModal('qrcode')">
        <div class="menu-icon icon-qr"><i class="fas fa-qrcode"></i></div>
        <div class="menu-label">QR Code</div>
        <div class="menu-desc">เธชเธณเธซเธฃเธฑเธเนเธชเธ”เธเนเธซเนเธเธฃเธน</div>
      </div>
      <div class="menu-item delay-4" onclick="openModal('profile')">
        <div class="menu-icon icon-profile"><i class="fas fa-user-astronaut"></i></div>
        <div class="menu-label">เนเธเธฃเนเธเธฅเน</div>
        <div class="menu-desc">เธเนเธญเธกเธนเธฅเธชเนเธงเธเธ•เธฑเธง</div>
      </div>
      <div class="menu-item delay-4" onclick="openModal('notifications')">
        <div class="menu-icon icon-notifications"
          style="background: rgba(255,77,106,0.08); color: var(--neon-red); border: 1px solid rgba(255,77,106,0.15);">
          <i class="fas fa-bell"></i>
        </div>
        <div class="menu-label">เธเธฒเธฃเนเธเนเธเน€เธ•เธทเธญเธ</div>
        <div class="menu-desc">เธ•เธดเธ”เธ•เธฒเธกเธชเธ–เธฒเธเธฐเธเธณเธฃเนเธญเธ</div>
      </div>
    </div>


  </div>

  <!-- Modal Template -->
  <div class="modal-overlay" id="mainModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Title</div>
        <button class="btn-close" onclick="closeModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body" id="modalBody">
        <!-- Content injected via JS -->
      </div>
    </div>
  </div>

  <!-- Info Section -->
  <div class="glass-card">
    <h3
      style="margin-bottom: 14px; font-weight: 500; display: flex; align-items: center; gap: 10px; color: var(--text);">
      <i class="fas fa-info-circle" style="color: var(--neon-blue)"></i> เธเนเธญเธกเธนเธฅเนเธ”เธขเธชเธฑเธเน€เธเธ
    </h3>
    <ul class="info-list">
      <li class="info-item">
        <div class="info-icon"><i class="fas fa-user"></i></div>
        <div class="info-content">
          <div class="info-content__label">เธเธทเนเธญ-เธเธฒเธกเธชเธเธธเธฅ</div>
          <div class="info-content__value" id="infoName">-</div>
        </div>
      </li>
      <li class="info-item">
        <div class="info-icon"><i class="fas fa-id-badge"></i></div>
        <div class="info-content">
          <div class="info-content__label">เธฃเธซเธฑเธชเธเธฑเธเน€เธฃเธตเธขเธ</div>
          <div class="info-content__value" id="infoId">-</div>
        </div>
      </li>
      <li class="info-item">
        <div class="info-icon"><i class="fas fa-heartbeat"></i></div>
        <div class="info-content">
          <div class="info-content__label">เธชเธ–เธฒเธเธฐเธเธคเธ•เธดเธเธฃเธฃเธก</div>
          <div class="info-content__value" id="infoStatus">-</div>
        </div>
      </li>
    </ul>
  </div>
  </div>

  <!-- Main Modal -->
  <div class="modal-overlay" id="mainModalOverlay" onclick="closeModal()">
    <div class="modal" id="mainModal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Title</h3>
        <button class="btn-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" id="modalContent">
        <!-- Dynamic Content -->
      </div>
    </div>
  </div>

  <!-- Profile Viewer Overlay -->
  <div class="pv-overlay" id="profileViewer" onclick="closeProfileViewer()">
    <button class="pv-close" onclick="closeProfileViewer()">&times;</button>
    <div id="pvImageContainer"></div>
    <div style="margin-top: 20px; text-align: center; color: white;">
      <h2 id="pvName" style="margin-bottom: 5px;"></h2>
      <p id="pvId" style="opacity: 0.7;"></p>
    </div>
  </div>

  <!-- Logout Confirm Modal -->
  <div class="modal-overlay" id="logoutConfirmOverlay" style="z-index: 3000;">
    <div class="glass-card"
      style="max-width: 380px; width: 90%; text-align: center; padding: 40px; border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 20px 60px rgba(0,0,0,0.5); animation: zoomIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);">
      <div style="font-size: 3.5rem; margin-bottom: 20px; display: inline-block; animation: wave 2s infinite;">๐‘
      </div>
      <h3
        style="font-size: 1.6rem; margin-bottom: 10px; font-weight: 700; background: linear-gradient(to right, #fff, #ffc371); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
        เธญเธญเธเธเธฒเธเธฃเธฐเธเธ</h3>
      <p style="color: var(--text-muted); margin-bottom: 30px; line-height: 1.6;">
        เธเธธเธ“เธ•เนเธญเธเธเธฒเธฃเธเธเธเธฒเธฃเธ—เธณเธเธฒเธ<br>เนเธเน€เธเธชเธเธฑเนเธเธเธตเนเนเธเนเธซเธฃเธทเธญเนเธกเน?
      </p>
      <div style="display: flex; gap: 15px;">
        <button onclick="closeLogoutModal()"
          style="flex: 1; padding: 14px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: white; font-weight: 600; cursor: pointer; transition: all 0.2s;">เธขเธเน€เธฅเธดเธ</button>
        <button onclick="confirmLogout()"
          style="flex: 1; padding: 14px; border-radius: 15px; border: none; background: linear-gradient(135deg, #ff5f6d, #ffc371); color: white; font-weight: 600; cursor: pointer; box-shadow: 0 10px 20px rgba(255, 95, 109, 0.3); transition: all 0.2s; transform: scale(1);">เธขเธทเธเธขเธฑเธ</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Score Submission Modal -->
  <div class="modal-overlay" id="scoreSubmitOverlay" onclick="closeScoreSubmitModal()">
    <div class="modal" style="max-width: 500px;" onclick="event.stopPropagation()">
      <div class="modal-header" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
        <h3 class="modal-title" style="-webkit-text-fill-color: #000; color: #000;">
          <i class="fas fa-plus-circle"></i> เธชเนเธเธเธญเน€เธเธดเนเธกเธเธฐเนเธเธ
        </h3>
        <button class="btn-close" onclick="closeScoreSubmitModal()" style="color: #000;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <!-- Student Info -->
        <div
          style="background: linear-gradient(135deg, rgba(0,242,254,0.1), rgba(79,172,254,0.1)); padding: 15px; border-radius: 12px; margin-bottom: 20px;">
          <div style="font-weight: 700; color: var(--primary);" id="submitStudentName">-</div>
          <div style="font-size: 0.9rem; color: var(--text-muted);" id="submitStudentId">เธฃเธซเธฑเธช: -</div>
        </div>

        <!-- Detail Input -->
        <div style="margin-bottom: 20px;">
          <label style="display: block; color: var(--text-muted); font-size: 0.9rem; margin-bottom: 8px;">
            เธฃเธฒเธขเธฅเธฐเน€เธญเธตเธขเธ”เธเธฒเธ / เธเธฒเธฃเนเธเนเนเธ
          </label>
          <textarea id="submitDetail"
            placeholder="เธฃเธฐเธเธธเธฃเธฒเธขเธฅเธฐเน€เธญเธตเธขเธ”เธเธฒเธเธซเธฃเธทเธญเธชเธดเนเธเธ—เธตเนเนเธเนเนเธ..."
            style="
            width: 100%;
            height: 100px;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
            color: var(--text-main);
            font-size: 1rem;
            resize: none;
            font-family: inherit;
          "></textarea>
        </div>

        <!-- Image Uploads -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
          <div style="text-align: center;">
            <input type="file" id="beforeImageInput" accept="image/*" style="display: none;"
              onchange="previewImage(this, 'beforePreview')">
            <div onclick="document.getElementById('beforeImageInput').click()" style="
              border: 2px dashed rgba(255,255,255,0.2);
              border-radius: 12px;
              padding: 30px 15px;
              cursor: pointer;
              transition: all 0.3s;
              min-height: 120px;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
            " id="beforeBox">
              <i class="fas fa-camera" style="font-size: 2rem; color: var(--text-muted); margin-bottom: 10px;"></i>
              <div style="color: var(--text-muted); font-size: 0.9rem;">เธเนเธญเธเธ—เธณ</div>
              <img id="beforePreview" src=""
                style="display: none; max-width: 100%; max-height: 80px; margin-top: 10px; border-radius: 8px;">
            </div>
          </div>
          <div style="text-align: center;">
            <input type="file" id="afterImageInput" accept="image/*" style="display: none;"
              onchange="previewImage(this, 'afterPreview')">
            <div onclick="document.getElementById('afterImageInput').click()" style="
              border: 2px dashed rgba(255,255,255,0.2);
              border-radius: 12px;
              padding: 30px 15px;
              cursor: pointer;
              transition: all 0.3s;
              min-height: 120px;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
            " id="afterBox">
              <i class="fas fa-edit" style="font-size: 2rem; color: var(--text-muted); margin-bottom: 10px;"></i>
              <div style="color: var(--text-muted); font-size: 0.9rem;">เธซเธฅเธฑเธเธ—เธณ</div>
              <img id="afterPreview" src=""
                style="display: none; max-width: 100%; max-height: 80px; margin-top: 10px; border-radius: 8px;">
            </div>
          </div>
        </div>

        <!-- Buttons -->
        <div style="display: flex; gap: 10px;">
          <button onclick="closeScoreSubmitModal()" style="
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            background: transparent;
            color: var(--text-main);
            font-weight: 600;
            cursor: pointer;
          ">เธขเธเน€เธฅเธดเธ</button>
          <button onclick="submitScoreRequest()" style="
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            color: #000;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
          "><i class="fas fa-paper-plane"></i> เธเธฑเธเธ—เธถเธเธเธฅเธเธฒเธ</button>
        </div>
      </div>
    </div>
  </div>


  <script>
    // --- Configuration & State ---
    const CONFIG = {
      checkInterval: 3000,
      animationDuration: 300
    };

    let currentUser = null;
    let pollInterval = null;

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
      initSession();
    });

    function initSession() {
      const storedUser = sessionStorage.getItem('currentUser');
      if (!storedUser) {
        window.location.href = 'index.html';
        return;
      }

      currentUser = JSON.parse(storedUser);
      updateUI(currentUser);
      startPolling();

      // Welcome Toast
      setTimeout(() => {
        showToast('success', 'เธขเธดเธเธ”เธตเธ•เนเธญเธเธฃเธฑเธ', `เธชเธงเธฑเธชเธ”เธตเธเธธเธ“ ${currentUser.name.split(' ')[0]}`);
      }, 500);
    }

    // --- Data Handling & Polling ---
    function startPolling() {
      if (pollInterval) clearInterval(pollInterval);

      pollInterval = setInterval(async () => {
        try {
          const timestamp = Date.now();
          const response = await fetch(`user2.1.json?v=${timestamp}`);
          if (!response.ok) return;

          const students = await response.json();
          const latestData = students.find(s => s.id === currentUser.id);

          if (latestData) {
            checkForUpdates(latestData);
          }
        } catch (error) {
          console.error("Polling error:", error);
        }
      }, CONFIG.checkInterval);
    }

    function checkForUpdates(newData) {
      let hasChanges = false;

      // Score Change
      if (newData.score !== currentUser.score) {
        const diff = newData.score - currentUser.score;
        const type = diff > 0 ? 'success' : 'error';
        const sign = diff > 0 ? '+' : '';
        showToast(type, 'เธเธฐเนเธเธเน€เธเธฅเธตเนเธขเธเนเธเธฅเธ', `เธเธฐเนเธเธเธเธญเธเธเธธเธ“ ${sign}${diff} (เนเธซเธกเน: ${newData.score})`);
        currentUser.score = newData.score;
        animateScoreUpdate(newData.score);
        hasChanges = true;
      }

      // Status Point Change
      const newStatusPoint = newData.statuspoint || 'normal';
      const currentStatusPoint = currentUser.statuspoint || 'normal';
      if (newStatusPoint !== currentStatusPoint) {
        showToast('info', 'เธชเธ–เธฒเธเธฐเน€เธเธฅเธตเนเธขเธ', `เธชเธ–เธฒเธเธฐเธเธคเธ•เธดเธเธฃเธฃเธกเธเธญเธเธเธธเธ“เน€เธเธฅเธตเนเธขเธเน€เธเนเธ "${getLocalizedStatus(newStatusPoint)}"`);
        currentUser.statuspoint = newStatusPoint;
        hasChanges = true;
      }

      // Other fields
      currentUser.status = newData.status;

      if (hasChanges) {
        sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
        updateUI(currentUser);
      }
    }

    // --- UI Updates ---
    function updateUI(user) {
      // Navbar
      document.getElementById('navUserName').textContent = user.name;
      document.getElementById('navUserId').textContent = `ID: ${user.id}`;
      document.getElementById('infoName').textContent = user.name;
      document.getElementById('infoId').textContent = user.id;

      // Score
      const scoreEl = document.getElementById('scoreValue');
      if (scoreEl.textContent !== String(user.score)) {
        scoreEl.textContent = user.score || 0;
      }

      // Status Badge & Info
      const statusKey = user.statuspoint || 'normal';
      const statusConfig = getStatusConfig(statusKey);

      const badgeHTML = `<i class="${statusConfig.icon}"></i> ${statusConfig.text}`;
      const badgeEl = document.getElementById('statusBadge');

      badgeEl.className = `status-pill ${statusConfig.class}`;
      badgeEl.innerHTML = badgeHTML;
      document.getElementById('infoStatus').textContent = statusConfig.text;
    }

    // --- Animation ---
    function animateScoreUpdate(newVal) {
      const el = document.getElementById('scoreValue');
      el.style.transform = 'scale(1.2)';
      el.style.textShadow = '0 0 50px var(--primary)';
      setTimeout(() => {
        el.textContent = newVal;
        el.style.transform = 'scale(1)';
        el.style.textShadow = '0 10px 30px rgba(0, 242, 254, 0.3)';
      }, 300);
    }

    // --- Helpers ---
    function getStatusConfig(status) {
      const map = {
        'normal': { text: 'เธเธเธ•เธด', class: 'status-normal', icon: 'fas fa-check-circle' },
        'risk': { text: 'เน€เธฃเธดเนเธกเธกเธตเธเธงเธฒเธกเน€เธชเธตเนเธขเธ', class: 'status-risk', icon: 'fas fa-exclamation-triangle' },
        'urgent': { text: 'เธเธฃเธฑเธเธเธฃเธธเธเธ”เนเธงเธ', class: 'status-urgent', icon: 'fas fa-radiation' },
        'excellent': { text: 'เน€เธ”เนเธเธ”เธตเธจเธฃเธตเน€เธ—เธเธฒ', class: 'status-excellent', icon: 'fas fa-star' }
      };
      return map[status] || map.normal;
    }

    function getLocalizedStatus(status) {
      return getStatusConfig(status).text;
    }

    // --- Modal System ---
    async function openModal(type) {
      const modal = document.getElementById('mainModalOverlay'); // Kept original ID for modal overlay
      const title = document.getElementById('modalTitle');
      const body = document.getElementById('modalContent'); // Kept original ID for modal content

      let content = {
        title: '',
        body: ''
      };

      // Clear previous content and show loading
      body.innerHTML = '<div style="text-align:center; padding:20px;"><i class="fas fa-circle-notch fa-spin"></i> เธเธณเธฅเธฑเธเนเธซเธฅเธ”...</div>';

      switch (type) {
        case 'history':
          content = await getHistoryContent();
          break;
        case 'rules':
          content = getRulesContent();
          break;
        case 'qrcode': // Kept original 'qrcode' type
          content = getQRContent();
          break;
        case 'profile':
          content = getProfileContent();
          break;
        case 'notifications': // NEW BLOCK
          content = getNotificationsContent();
          // Load data after modal opens
          setTimeout(loadStudentNotifications, 100);
          break;
      }

      title.innerHTML = content.title;
      body.innerHTML = content.body;

      modal.classList.add('active');

      // Init QR if needed
      if (type === 'qrcode') { // Kept original 'qrcode' type
        setTimeout(() => {
          const qrBox = document.getElementById('qrCanvas');
          if (qrBox) {
            new QRCode(qrBox, {
              text: currentUser.id,
              width: 200,
              height: 200,
              colorDark: "#24243e",
              colorLight: "#ffffff",
              correctLevel: QRCode.CorrectLevel.H
            });
          }
        }, 100);
      }
    }

    function closeModal() {
      const modalOverlay = document.getElementById('mainModalOverlay');
      modalOverlay.classList.remove('active');
    }

    // --- Modal Content Generators ---
    async function getHistoryContent() {
      try {
        const res = await fetch('log.json');
        if (!res.ok) throw new Error('Load failed');
        const logs = await res.json();

        // Filter last 3 months
        const limitDate = new Date();
        limitDate.setMonth(limitDate.getMonth() - 3);

        const userLogs = logs
          .filter(l => l.student_id === currentUser.id && new Date(l.timestamp) > limitDate)
          .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        if (userLogs.length === 0) {
          return {
            title: '<i class="fas fa-history"></i> เธเธฃเธฐเธงเธฑเธ•เธดเธเธฐเนเธเธ',
            body: '<div style="text-align:center; padding: 30px; color: var(--text-muted);">เธขเธฑเธเนเธกเนเธกเธตเธเธฃเธฐเธงเธฑเธ•เธดเธเธฒเธฃเน€เธเธฅเธตเนเธขเธเนเธเธฅเธเธเธฐเนเธเธเน€เธฃเนเธงเน เธเธตเน</div>'
          };
        }

        let html = '<ul style="list-style:none;">';
        userLogs.forEach(log => {
          const date = new Date(log.timestamp).toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: '2-digit', hour: '2-digit', minute: '2-digit' });
          const isPositive = log.change > 0;
          const color = isPositive ? 'var(--success)' : 'var(--danger)';
          const sign = isPositive ? '+' : '';

          html += `
                        <li style="padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 500;">${log.reason}</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);"><i class="far fa-clock"></i> ${date}</div>
                            </div>
                            <div style="font-weight: 700; font-size: 1.1rem; color: ${color};">
                                ${sign}${log.change}
                            </div>
                        </li>
                    `;
        });
        html += '</ul>';

        return {
          title: '<i class="fas fa-history"></i> เธเธฃเธฐเธงเธฑเธ•เธดเธเธฐเนเธเธ',
          body: html
        };

      } catch (e) {
        return { title: 'เธเนเธญเธเธดเธ”เธเธฅเธฒเธ”', body: 'เนเธกเนเธชเธฒเธกเธฒเธฃเธ–เนเธซเธฅเธ”เธเนเธญเธกเธนเธฅเธเธฃเธฐเธงเธฑเธ•เธดเนเธ”เน' };
      }
    }

    function getRulesContent() {
      return {
        title: '<i class="fas fa-book-open"></i> เธเธเธฃเธฐเน€เธเธตเธขเธ',
        body: `
            <h3>๐ซ เธเธฒเธฃเธซเธฑเธเธเธฐเนเธเธ</h3>
            <ul>
                <li><strong style="color:var(--danger)">-10</strong> : เธกเธฒเธชเธฒเธข / เธเธธเธเธฅเธดเธเธ เธฒเธ/เธเธฒเธฃเนเธ•เนเธเธเธฒเธขเธเธดเธ”เธฃเธฐเน€เธเธตเธขเธ</li>
                <li><strong style="color:var(--danger)">-10</strong> : เนเธกเนเธชเธงเธกเธซเธกเธงเธเธเธฑเธเธเนเธญเธ</li>
                <li><strong style="color:var(--danger)">-20</strong> : เธ—เธฐเน€เธฅเธฒเธฐเธงเธดเธงเธฒเธ— / เธเนเธฒเธงเธฃเนเธฒเธง</li>
                <li><strong style="color:var(--danger)">-30</strong> : เธชเธนเธเธเธธเธซเธฃเธตเน / เธชเธดเนเธเน€เธชเธเธ•เธดเธ” / เธเธเธญเธฒเธงเธธเธ</li>
                <li><strong style="color:var(--danger)">-60</strong> : เธเธธเธซเธฃเธตเนเนเธเธเนเธฒ</li>
            </ul>
            <div style="margin-top: 20px; padding: 15px; background: rgba(255,165,0,0.1); border-left: 3px solid orange; border-radius: 8px; font-size: 0.9rem;">
                <i class="fas fa-lightbulb"></i> เธเธคเธ•เธดเธเธฃเธฃเธกเธ”เธตเธกเธตเนเธญเธเธฒเธชเนเธ”เนเธฃเธฑเธเธเธฐเนเธเธเน€เธเธดเนเธกเธ•เธฒเธกเธ”เธธเธฅเธขเธเธดเธเธดเธเธเธญเธเธเธฃเธน
            </div>
            
            <!-- Score Submission Button -->
            <div style="margin-top: 25px; text-align: center;">
              <button onclick="openScoreSubmitModal()" style="
                background: linear-gradient(135deg, #43e97b, #38f9d7);
                border: none;
                padding: 15px 30px;
                border-radius: 15px;
                color: #000;
                font-weight: 700;
                font-size: 1rem;
                cursor: pointer;
                display: inline-flex;
                align-items: center;
                gap: 10px;
                box-shadow: 0 10px 25px rgba(67, 233, 123, 0.3);
                transition: all 0.3s;
              ">
                <i class="fas fa-plus-circle"></i>
                เธชเนเธเธเธญเน€เธเธดเนเธกเธเธฐเนเธเธ
              </button>
              <p style="color: var(--text-muted); font-size: 0.8rem; margin-top: 10px;">
                เธชเนเธเธซเธฅเธฑเธเธเธฒเธเธเธฒเธฃเธ—เธณเธเธงเธฒเธกเธ”เธต/เธเนเธงเธขเน€เธซเธฅเธทเธญเนเธฃเธเน€เธฃเธตเธขเธ
              </p>
            </div>
        `
      };
    }

    function getNotificationsContent() {
      return {
        title: '<i class="fas fa-bell"></i> เธเธฒเธฃเนเธเนเธเน€เธ•เธทเธญเธ',
        body: `
            <div id="notificationList" style="display: flex; flex-direction: column; gap: 15px;">
                <div style="text-align: center; padding: 20px; color: var(--text-muted);">
                    <i class="fas fa-spinner fa-spin"></i> เธเธณเธฅเธฑเธเนเธซเธฅเธ”...
                </div>
            </div>
        `
      };
    }

    async function loadStudentNotifications() {
      const list = document.getElementById('notificationList');
      if (!list) return;

      try {
        const response = await fetch('/toadmin.json');
        const data = await response.json();

        // Filter by current student ID
        const myNotifications = data.filter(item => String(item.student_id) === String(currentUser.id));

        // Sort by timestamp desc
        myNotifications.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        if (myNotifications.length === 0) {
          list.innerHTML = `
              <div style="text-align: center; padding: 40px 20px; color: var(--text-muted);">
                  <i class="fas fa-bell-slash" style="font-size: 3em; margin-bottom: 15px; opacity: 0.5;"></i>
                  <br>เนเธกเนเธกเธตเธเธฒเธฃเนเธเนเธเน€เธ•เธทเธญเธ
              </div>
          `;
          return;
        }

        list.innerHTML = myNotifications.map(item => {
          const date = new Date(item.timestamp).toLocaleString('th-TH');
          let statusColor = '#f7b733'; // Pending = Yellow
          let statusIcon = 'fa-clock';
          let statusText = 'เธฃเธญเธเธฒเธฃเธ•เธฃเธงเธเธชเธญเธ';
          let bgColor = 'rgba(247, 183, 51, 0.1)';
          let borderColor = 'rgba(247, 183, 51, 0.3)';

          if (item.status === 'completed') {
            statusColor = '#00b09b'; // Success = Green
            statusIcon = 'fa-check-circle';
            statusText = 'เธญเธเธธเธกเธฑเธ•เธดเนเธฅเนเธง';
            bgColor = 'rgba(0, 176, 155, 0.1)';
            borderColor = 'rgba(0, 176, 155, 0.3)';
          } else if (item.status === 'rejected') {
            statusColor = '#ff5f6d'; // Rejected = Red
            statusIcon = 'fa-times-circle';
            statusText = 'เธ–เธนเธเธเธเธดเน€เธชเธ';
            bgColor = 'rgba(255, 95, 109, 0.1)';
            borderColor = 'rgba(255, 95, 109, 0.3)';
          }

          const reason = item.admin_reason || item.reason || item.detail || '-';

          return `
              <div style="background: ${bgColor}; border: 1px solid ${borderColor}; border-radius: 12px; padding: 15px;">
                  <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                      <div style="font-weight: 600; color: ${statusColor}; display: flex; align-items: center; gap: 6px;">
                          <i class="fas ${statusIcon}"></i> ${statusText}
                      </div>
                      <div style="font-size: 0.8rem; color: var(--text-muted);">${date}</div>
                  </div>
                  <div style="color: var(--text-main); margin-bottom: 8px;">
                      ${item.detail || item.reason || 'เธชเนเธเธเธณเธฃเนเธญเธ'}
                  </div>
                  ${item.status === 'rejected' ? `
                      <div style="font-size: 0.9rem; color: #ff5f6d; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px;">
                          <i class="fas fa-comment-alt"></i> เน€เธซเธ•เธธเธเธฅ: ${reason}
                      </div>
                  ` : ''}
                  ${item.status === 'completed' && item.admin_reason ? `
                      <div style="font-size: 0.9rem; color: #00b09b; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px;">
                          <i class="fas fa-comment-check"></i> ${item.admin_reason}
                      </div>
                  ` : ''}
              </div>
          `;
        }).join('');

      } catch (e) {
        console.error(e);
        list.innerHTML = '<div style="text-align: center; color: var(--danger);">เน€เธเธดเธ”เธเนเธญเธเธดเธ”เธเธฅเธฒเธ”เนเธเธเธฒเธฃเนเธซเธฅเธ”เธเนเธญเธกเธนเธฅ</div>';
      }
    }

    function getQRContent() {
      return {
        title: '<i class="fas fa-qrcode"></i> QR Student ID',
        body: `
            <div style="text-align: center; padding: 10px;">
                <div style="display: inline-block; padding: 20px; border-radius: 14px; background: #12141c; border: 1px solid #2a2d3a;">
                    
                    <div id="qrCanvas" style="background: white; padding: 12px; border-radius: 10px;"></div>
                    
                    <div style="margin-top: 14px; font-family: 'Prompt', sans-serif;">
                        <div style="font-size: 0.75rem; color: #555872; text-transform: uppercase; letter-spacing: 1px;">Student ID</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #00d4ff; margin-top: 2px;">${currentUser.id}</div>
                    </div>
                </div>
                
                <p style="color: #8b8fa7; font-size: 0.85rem; margin-top: 20px;">
                    <i class="fas fa-check-circle" style="color: #22d3a7;"></i> เธเธฃเนเธญเธกเธชเธณเธซเธฃเธฑเธเธเธฒเธฃเธชเนเธเธ
                </p>
            </div>
        `
      };
    }

    function getProfileContent() {
      const timestamp = Date.now();
      const imgSrc = `edstudent/${currentUser.id}.jpg?v=${timestamp}`;

      return {
        title: '<i class="fas fa-user-circle"></i> เธเนเธญเธกเธนเธฅเธชเนเธงเธเธ•เธฑเธง',
        body: `
            <div class="profile-header">
                <div class="profile-img-container" onclick="openProfileViewer('${imgSrc}')">
                    <img src="${imgSrc}" class="profile-img" onerror="this.src='https://ui-avatars.com/api/?name=${currentUser.name}&background=random&color=fff'">
                    <div class="profile-badge"><i class="fas fa-search-plus"></i></div>
                </div>
                <h3 style="border: none; margin: 0;">${currentUser.name}</h3>
                <p style="color: var(--text-muted);">${currentUser.id}</p>
            </div>

            <div style="background: rgba(0,0,0,0.2); border-radius: 12px; padding: 20px;">
                <div style="margin-bottom: 15px;">
                    <label style="color: var(--text-muted); font-size: 0.8rem;">เธชเธ–เธฒเธเธฐเธเธฒเธฃเน€เธฃเธตเธขเธ</label>
                    <div style="font-weight: 500;">${getAcademicStatus(currentUser.status)}</div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: var(--text-muted); font-size: 0.8rem;">เธฃเธฐเธ”เธฑเธเธเธคเธ•เธดเธเธฃเธฃเธก</label>
                    <div style="font-weight: 500;">${getLocalizedStatus(currentUser.statuspoint || 'normal')}</div>
                </div>
                <div>
                    <label style="color: var(--text-muted); font-size: 0.8rem;">เธเธฐเนเธเธเธชเธฐเธชเธก</label>
                    <div style="font-weight: 500;">${currentUser.score} เธเธฐเนเธเธ</div>
                </div>
            </div>
        `
      };
    }

    function getAcademicStatus(st) {
      const map = {
        'normal': 'เธเธณเธฅเธฑเธเธจเธถเธเธฉเธฒเธญเธขเธนเน',
        'Absent': 'เธเธฒเธ”เน€เธฃเธตเธขเธเธเธฒเธ',
        'moved': 'เธขเนเธฒเธขเธชเธ–เธฒเธเธจเธถเธเธฉเธฒ',
        'notnormal': 'เธเธฑเธเธเธฒเธฃเน€เธฃเธตเธขเธ'
      };
      return map[st] || 'เธเธณเธฅเธฑเธเธจเธถเธเธฉเธฒเธญเธขเธนเน';
    }

    // --- Profile Viewer ---
    function openProfileViewer(src) {
      if (!src) return;
      const pv = document.getElementById('profileViewer');
      const imgContainer = document.getElementById('pvImageContainer');
      document.getElementById('pvName').textContent = currentUser.name;
      document.getElementById('pvId').textContent = currentUser.id;

      imgContainer.innerHTML = `<img src="${src}" class="pv-img" onerror="this.src='https://ui-avatars.com/api/?name=${currentUser.name}&size=512'">`;
      pv.classList.add('active');
    }

    function closeProfileViewer() {
      document.getElementById('profileViewer').classList.remove('active');
    }

    // --- Toast System ---
    function showToast(type, title, message) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');

      const icons = {
        success: 'fas fa-check-circle',
        error: 'fas fa-times-circle',
        info: 'fas fa-info-circle',
        warning: 'fas fa-exclamation-triangle'
      };

      toast.className = `toast toast-${type}`;
      toast.innerHTML = `
        <div class="toast-icon"><i class="${icons[type] || icons.info}"></i></div>
        <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-msg">${message}</div>
        </div>
      `;

      container.appendChild(toast);

      // Trigger animation
      requestAnimationFrame(() => {
        toast.classList.add('show');
      });

      // Auto Remove
      setTimeout(() => {
        toast.classList.remove('show');
        toast.addEventListener('transitionend', () => toast.remove());
      }, 4000);
    }

    // --- Logout ---
    function logout() {
      const overlay = document.getElementById('logoutConfirmOverlay');
      overlay.classList.add('active');
    }

    function closeLogoutModal() {
      const overlay = document.getElementById('logoutConfirmOverlay');
      overlay.classList.remove('active');
    }

    function confirmLogout() {
      closeLogoutModal();
      clearInterval(pollInterval);
      sessionStorage.removeItem('currentUser');

      // Fancy exit
      document.body.style.opacity = '0';
      document.body.style.transform = 'scale(0.95)';
      document.body.style.transition = 'all 0.5s ease';

      setTimeout(() => {
        window.location.href = 'index.html';
      }, 500);
    }

    // --- Score Submission Functions ---
    function openScoreSubmitModal() {
      closeModal(); // Close rules modal first

      // Populate student info
      document.getElementById('submitStudentName').textContent = currentUser.name;
      document.getElementById('submitStudentId').textContent = 'เธฃเธซเธฑเธช: ' + currentUser.id;

      // Clear previous inputs
      document.getElementById('submitDetail').value = '';
      document.getElementById('beforeImageInput').value = '';
      document.getElementById('afterImageInput').value = '';
      document.getElementById('beforePreview').style.display = 'none';
      document.getElementById('afterPreview').style.display = 'none';

      // Show modal
      document.getElementById('scoreSubmitOverlay').classList.add('active');
    }

    function closeScoreSubmitModal() {
      document.getElementById('scoreSubmitOverlay').classList.remove('active');
    }

    function previewImage(input, previewId) {
      const file = input.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const preview = document.getElementById(previewId);
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    }

    async function getBase64FromInput(inputId) {
      const input = document.getElementById(inputId);
      if (!input.files || !input.files[0]) return '';

      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.readAsDataURL(input.files[0]);
      });
    }

    async function submitScoreRequest() {
      const detail = document.getElementById('submitDetail').value.trim();
      const beforeInput = document.getElementById('beforeImageInput');
      const afterInput = document.getElementById('afterImageInput');

      // Validate all fields
      if (!detail) {
        showToast('error', 'เธเธฃเธธเธ“เธฒเธเธฃเธญเธเธเนเธญเธกเธนเธฅ', 'เธฃเธฐเธเธธเธฃเธฒเธขเธฅเธฐเน€เธญเธตเธขเธ”เธเธฒเธ/เธเธฒเธฃเนเธเนเนเธ');
        return;
      }

      if (!beforeInput.files || beforeInput.files.length === 0) {
        showToast('error', 'เธเธฃเธธเธ“เธฒเนเธเธเธฃเธนเธ', 'เธเธฃเธธเธ“เธฒเธญเธฑเธเนเธซเธฅเธ”เธฃเธนเธ "เธเนเธญเธเธ—เธณ"');
        return;
      }

      if (!afterInput.files || afterInput.files.length === 0) {
        showToast('error', 'เธเธฃเธธเธ“เธฒเนเธเธเธฃเธนเธ', 'เธเธฃเธธเธ“เธฒเธญเธฑเธเนเธซเธฅเธ”เธฃเธนเธ "เธซเธฅเธฑเธเธ—เธณ"');
        return;
      }

      // Show loading
      showToast('info', 'เธเธณเธฅเธฑเธเธชเนเธ...', 'เธเธฃเธธเธ“เธฒเธฃเธญเธชเธฑเธเธเธฃเธนเน');

      try {
        const beforeBase64 = await getBase64FromInput('beforeImageInput');
        const afterBase64 = await getBase64FromInput('afterImageInput');

        const data = {
          student_id: currentUser.id,
          student_name: currentUser.name,
          detail: detail,
          image_before: beforeBase64,
          image_after: afterBase64,
          teacher: 'เธเธฑเธเน€เธฃเธตเธขเธเธชเนเธเน€เธญเธ',
          timestamp: new Date().toISOString(),
          status: 'pending',
          type: 'work',
          save_folder: 'profly' // Tell server to save images to profly folder
        };

        const response = await fetch('/api/save-work', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.status === 'success') {
          showToast('success', 'เธชเนเธเน€เธชเธฃเนเธเธชเธดเนเธ', 'เธฃเธญเธเธฃเธนเธ•เธฃเธงเธเธชเธญเธเนเธฅเธฐเธญเธเธธเธกเธฑเธ•เธด');
          closeScoreSubmitModal();
        } else {
          throw new Error(result.message || 'Failed to submit');
        }
      } catch (error) {
        console.error('Submit error:', error);
        showToast('error', 'เน€เธเธดเธ”เธเนเธญเธเธดเธ”เธเธฅเธฒเธ”', error.message);
      }
    }

  </script>

  <div class="footer-section">
    ยฉ 2026 เธเธฒเธเธชเธฒเธงเธชเนเธฃเธเธฒ เน€เธกเธทเธญเธเธกเธธเธชเธดเธ & เธ”.เธ.เน€เธ—เธดเธ”เธจเธฑเธเธ”เธดเน
    เธชเธธเธงเธฃเธฃเธ“เธกเธฒเธฅเธต
  </div>

  <style>
    .footer-section {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: var(--text-3);
      font-size: 0.7rem;
      text-align: center;
      background: var(--surface);
      padding: 4px 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      white-space: nowrap;
    }
  </style>
</body>

</html>